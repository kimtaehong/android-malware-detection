import os
import csv
import numpy as np
import zlib
import getopt
import sys
import collections

from sklearn.cluster import KMeans
from sklearn import metrics

from scipy.spatial.distance import euclidean
from sklearn.metrics import pairwise_distances_argmin_min
from sklearn.model_selection import KFold
from matplotlib import pyplot as plt
import pandas as pd

import itertools


label_result = dict() 
tp_counter = collections.defaultdict(dict)

# /home/genian/SEQUOIA/branches/CURRENT/src/devops/ml/sklearn/clustering/A595940_F8803.csv
df_pre = pd.read_csv('./train.csv')

dataset = df_pre.values
Hash_Name = dataset[:,0]
MalwareBenign = dataset[:,1]
Feature = dataset[:,2:]

# n_clusters = 8803
print("[+] Kmeans Start n: 30")
kmeans = KMeans(n_clusters=30, random_state=0, n_jobs=-1).fit(Feature)
kmeans_result = (kmeans.labels_).tolist()
centroid = (kmeans.cluster_centers_).tolist()

# closest = nearest point index
closest, _ = pairwise_distances_argmin_min(kmeans.cluster_centers_, Feature)

fp1 = open("./output.csv", 'w') #output file write
fp1.write("Cluster Num." + ", " + "File_Name" + ", " + "Benign_Malware" + "\n")
closest = closest.tolist()


for i in range(0,len(closest)):
    cluster_num = str(i)
    malware_benign = str(MalwareBenign[closest[i]])
    file_name = str(Hash_Name[closest[i]])
    fp1.write(cluster_num + "," + file_name + ", " + malware_benign + "\n")

# Nearest Malware
if __name__ == "__main__":
    pass
